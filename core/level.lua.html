<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
	<title>/home/etn/.dev/love2d/projet-tut/core/level.lua</title>
	<meta http-equiv="content-type" content="text/html;charset=utf-8" />
	<meta name="generator" content="Geany 0.21" />
	<meta name="date" content="2014-01-03T02:10:46+0100" />
	<style type="text/css">
	body
	{
		font-family: Droid Sans Mono, monospace;
		font-size: 9pt;
	}
	.style_0
	{
		color: #000000;
		background-color: #ffffff;
	}
	.style_2
	{
		color: #d00000;
		background-color: #ffffff;
	}
	.style_4
	{
		color: #007f00;
		background-color: #ffffff;
	}
	.style_5
	{
		color: #00007f;
		background-color: #ffffff;
		font-weight: bold;
	}
	.style_6
	{
		color: #ff901e;
		background-color: #ffffff;
	}
	.style_7
	{
		color: #008000;
		background-color: #ffffff;
	}
	.style_10
	{
		color: #301010;
		background-color: #ffffff;
	}
	.style_11
	{
		color: #000000;
		background-color: #ffffff;
	}
	.style_13
	{
		color: #991111;
		background-color: #ffffff;
	}
	.style_14
	{
		color: #690000;
		background-color: #ffffff;
	}
	.style_32
	{
		color: #000026;
		background-color: #000000;
		font-weight: bold;
		font-style: italic;
	}
	.style_33
	{
		color: #000000;
		background-color: #20c5580;
		font-style: italic;
	}
	.style_34
	{
		color: #2078e50;
		background-color: #000000;
		font-weight: bold;
	}
	.style_39
	{
		color: #000000;
		background-color: #000000;
		font-style: italic;
	}
	.style_42
	{
		color: #d3a77510;
		background-color: #007fff;
		font-weight: bold;
	}
	.style_43
	{
		color: #007faa;
		background-color: #210e290;
		font-style: italic;
	}
	.style_44
	{
		color: #d3a772d0;
		background-color: #007fff;
		font-weight: bold;
		font-style: italic;
	}
	.style_46
	{
		color: #2078200;
		background-color: #000000;
		font-weight: bold;
	}
	.style_48
	{
		color: #000000;
		background-color: #000000;
		font-weight: bold;
	}
	.style_51
	{
		color: #000000;
		background-color: #2080aa0;
		font-style: italic;
	}
	.style_52
	{
		color: #210e290;
		background-color: #000000;
		font-weight: bold;
	}
	.style_54
	{
		color: #3ad26979;
		background-color: #007faa;
		font-weight: bold;
	}
	.style_56
	{
		color: #2078e50;
		background-color: #000000;
		font-weight: bold;
	}
	.style_58
	{
		color: #d3a77580;
		background-color: #007fff;
		font-weight: bold;
		font-style: italic;
	}
	.style_60
	{
		color: #20c5a60;
		background-color: #000000;
		font-weight: bold;
	}
	.style_61
	{
		color: #000000;
		background-color: #3c3cbef2;
		font-weight: bold;
		font-style: italic;
	}
	.style_62
	{
		color: #1644de0;
		background-color: #000000;
		font-weight: bold;
		font-style: italic;
	}
	.style_63
	{
		color: #007faa;
		background-color: #1644de0;
		font-style: italic;
	}
	.style_64
	{
		color: #000002;
		background-color: #000000;
		font-weight: bold;
	}
	.style_65
	{
		color: #007faa;
		background-color: #3afa7c1b;
		font-weight: bold;
		font-style: italic;
	}
	.style_66
	{
		color: #000000;
		background-color: #000000;
		font-weight: bold;
		font-style: italic;
	}
	.style_67
	{
		color: #007faa;
		background-color: #000019;
		font-style: italic;
	}
	.style_68
	{
		color: #40000005;
		background-color: #000000;
		font-weight: bold;
		font-style: italic;
	}
	.style_69
	{
		color: #000000;
		background-color: #3c593759;
		font-weight: bold;
		font-style: italic;
	}
	.style_70
	{
		color: #000014;
		background-color: #000000;
		font-weight: bold;
		font-style: italic;
	}
	.style_71
	{
		color: #000000;
		background-color: #1644e30;
		font-style: italic;
	}
	.style_72
	{
		color: #000000;
		background-color: #000000;
		font-weight: bold;
		font-style: italic;
	}
	.style_73
	{
		color: #000000;
		background-color: #d3a77510;
		font-weight: bold;
		font-style: italic;
	}
	.style_74
	{
		color: #20995a8;
		background-color: #000000;
		font-weight: bold;
		font-style: italic;
	}
	.style_75
	{
		color: #007faa;
		background-color: #1644ea0;
		font-style: italic;
	}
	.style_76
	{
		color: #000028;
		background-color: #000000;
		font-weight: bold;
		font-style: italic;
	}
	.style_78
	{
		color: #1641800;
		background-color: #000000;
		font-weight: bold;
	}
	.style_79
	{
		color: #000000;
		background-color: #3c6d5e58;
		font-weight: bold;
		font-style: italic;
	}
	.style_80
	{
		color: #d3a77530;
		background-color: #007fff;
		font-weight: bold;
		font-style: italic;
	}
	.style_82
	{
		color: #3ad26979;
		background-color: #007faa;
		font-weight: bold;
	}
	.style_83
	{
		color: #007faa;
		background-color: #000028;
		font-style: italic;
	}
	.style_84
	{
		color: #207bdb0;
		background-color: #000000;
		font-weight: bold;
		font-style: italic;
	}
	.style_86
	{
		color: #17cf500;
		background-color: #000000;
		font-weight: bold;
		font-style: italic;
	}
	.style_87
	{
		color: #000000;
		background-color: #000000;
		font-style: italic;
	}
	.style_88
	{
		color: #d3a77728;
		background-color: #007fff;
		font-weight: bold;
	}
	.style_89
	{
		color: #007fff;
		background-color: #d3a775b0;
		font-weight: bold;
		font-style: italic;
	}
	.style_90
	{
		color: #3c5949f0;
		background-color: #007faa;
		font-weight: bold;
	}
	.style_94
	{
		color: #000000;
		background-color: #000000;
		font-weight: bold;
	}
	.style_95
	{
		color: #000000;
		background-color: #3c6d444c;
		font-weight: bold;
		font-style: italic;
	}
	.style_96
	{
		color: #000000;
		background-color: #000000;
		font-weight: bold;
		font-style: italic;
	}
	.style_98
	{
		color: #000020;
		background-color: #000030;
		font-weight: bold;
		font-style: italic;
	}
	.style_100
	{
		color: #d3a77728;
		background-color: #007fff;
	}
	.style_101
	{
		color: #000000;
		background-color: #00000f;
		font-style: italic;
	}
	.style_102
	{
		color: #20c5610;
		background-color: #000000;
		font-weight: bold;
		font-style: italic;
	}
	.style_105
	{
		color: #000000;
		background-color: #3ad042ec;
		font-weight: bold;
		font-style: italic;
	}
	.style_106
	{
		color: #d3a776e0;
		background-color: #007fff;
		font-weight: bold;
		font-style: italic;
	}
	.style_107
	{
		color: #007fff;
		background-color: #20e8ec0;
		font-style: italic;
	}
	.style_108
	{
		color: #000000;
		background-color: #000000;
		font-weight: bold;
		font-style: italic;
	}
	.style_110
	{
		color: #2097660;
		background-color: #000000;
		font-weight: bold;
		font-style: italic;
	}
	.style_111
	{
		color: #007fff;
		background-color: #20e8ec0;
		font-style: italic;
	}
	.style_112
	{
		color: #00030a;
		background-color: #0002e1;
		font-weight: bold;
		font-style: italic;
	}
	.style_114
	{
		color: #3c3c28cb;
		background-color: #007faa;
	}
	.style_116
	{
		color: #000000;
		background-color: #000000;
		font-weight: bold;
		font-style: italic;
	}
	.style_118
	{
		color: #d3a77840;
		background-color: #007fff;
		font-weight: bold;
	}
	.style_119
	{
		color: #007faa;
		background-color: #00030a;
		font-weight: bold;
		font-style: italic;
	}
	.style_120
	{
		color: #2080a00;
		background-color: #000000;
		font-weight: bold;
		font-style: italic;
	}
	.style_122
	{
		color: #3ad26979;
		background-color: #007faa;
		font-weight: bold;
	}
	.style_123
	{
		color: #007faa;
		background-color: #2080a00;
		font-style: italic;
	}
	.style_124
	{
		color: #0002fa;
		background-color: #0002e1;
		font-weight: bold;
		font-style: italic;
	}
	.style_126
	{
		color: #17bd700;
		background-color: #000000;
		font-weight: bold;
	}
	.style_127
	{
		color: #000000;
		background-color: #000070;
		font-style: italic;
	}
	.style_128
	{
		color: #21120f0;
		background-color: #000000;
		font-weight: bold;
		font-style: italic;
	}
	.style_130
	{
		color: #3c3f81e0;
		background-color: #007faa;
	}
	.style_131
	{
		color: #007fff;
		background-color: #000000;
		font-style: italic;
	}
	.style_132
	{
		color: #d3a77ae0;
		background-color: #007fff;
		font-weight: bold;
		font-style: italic;
	}
	.style_134
	{
		color: #3c3f6d20;
		background-color: #007faa;
		font-weight: bold;
	}
	.style_136
	{
		color: #3c3f6d20;
		background-color: #007faa;
		font-weight: bold;
		font-style: italic;
	}
	.style_138
	{
		color: #3afa68c0;
		background-color: #007faa;
		font-weight: bold;
	}
	.style_139
	{
		color: #000000;
		background-color: #3afa68c0;
		font-weight: bold;
		font-style: italic;
	}
	.style_140
	{
		color: #d3a77aa0;
		background-color: #007fff;
		font-weight: bold;
		font-style: italic;
	}
	.style_142
	{
		color: #3afb2825;
		background-color: #007faa;
		font-weight: bold;
	}
	.style_143
	{
		color: #007faa;
		background-color: #40000003;
		font-style: italic;
	}
	.style_144
	{
		color: #d3a77ae0;
		background-color: #007fff;
		font-weight: bold;
	}
	.style_146
	{
		color: #3afcc765;
		background-color: #007faa;
	}
	.style_147
	{
		color: #007faa;
		background-color: #d3a77a70;
		font-weight: bold;
		font-style: italic;
	}
	.style_148
	{
		color: #d3a77a90;
		background-color: #007fff;
		font-weight: bold;
	}
	.style_150
	{
		color: #3ad03c01;
		background-color: #007faa;
		font-weight: bold;
	}
	.style_152
	{
		color: #1644de0;
		background-color: #000000;
		font-weight: bold;
		font-style: italic;
	}
	.style_153
	{
		color: #007fff;
		background-color: #d3a77d20;
		font-weight: bold;
		font-style: italic;
	}
	.style_154
	{
		color: #20bbb70;
		background-color: #000000;
		font-weight: bold;
	}
	.style_156
	{
		color: #000030;
		background-color: #000000;
		font-weight: bold;
		font-style: italic;
	}
	.style_158
	{
		color: #000000;
		background-color: #000000;
	}
	.style_159
	{
		color: #007fff;
		background-color: #15d0500;
		font-style: italic;
	}
	.style_160
	{
		color: #d3a77d20;
		background-color: #007fff;
		font-weight: bold;
		font-style: italic;
	}
	.style_161
	{
		color: #007fff;
		background-color: #d3a77b80;
		font-weight: bold;
		font-style: italic;
	}
	.style_162
	{
		color: #3acdae23;
		background-color: #007faa;
		font-weight: bold;
		font-style: italic;
	}
	.style_164
	{
		color: #16443b0;
		background-color: #000000;
		font-weight: bold;
		font-style: italic;
	}
	.style_165
	{
		color: #007fff;
		background-color: #3ad265e1;
		font-weight: bold;
		font-style: italic;
	}
	.style_166
	{
		color: #3afc0df2;
		background-color: #007faa;
		font-weight: bold;
		font-style: italic;
	}
	.style_168
	{
		color: #000001;
		background-color: #000000;
		font-weight: bold;
	}
	.style_169
	{
		color: #000000;
		background-color: #d3a77b50;
		font-weight: bold;
		font-style: italic;
	}
	.style_172
	{
		color: #000000;
		background-color: #000000;
	}
	.style_180
	{
		color: #000026;
		background-color: #000000;
		font-weight: bold;
		font-style: italic;
	}
	.style_181
	{
		color: #000000;
		background-color: #3c3c28cb;
		font-weight: bold;
		font-style: italic;
	}
	.style_182
	{
		color: #d3a77d20;
		background-color: #007fff;
		font-weight: bold;
	}
	.style_184
	{
		color: #000000;
		background-color: #000000;
	}
	.style_185
	{
		color: #007faa;
		background-color: #000068;
		font-style: italic;
	}
	.style_186
	{
		color: #3ad26979;
		background-color: #007faa;
	}
	.style_187
	{
		color: #007faa;
		background-color: #000000;
		font-style: italic;
	}
	.style_188
	{
		color: #180aae0;
		background-color: #000000;
		font-weight: bold;
	}
	.style_189
	{
		color: #000000;
		background-color: #3ad26979;
		font-weight: bold;
		font-style: italic;
	}
	.style_190
	{
		color: #3ad03c51;
		background-color: #007faa;
	}
	.style_191
	{
		color: #007faa;
		background-color: #3000fe70;
		font-weight: bold;
		font-style: italic;
	}
	.style_192
	{
		color: #000000;
		background-color: #000000;
		font-weight: bold;
	}
	.style_194
	{
		color: #000000;
		background-color: #000000;
		font-weight: bold;
	}
	.style_196
	{
		color: #177f880;
		background-color: #000000;
		font-weight: bold;
		font-style: italic;
	}
	.style_202
	{
		color: #3ad041cb;
		background-color: #007faa;
	}
	.style_203
	{
		color: #000000;
		background-color: #20a7a80;
		font-style: italic;
	}
	.style_204
	{
		color: #000000;
		background-color: #000000;
		font-weight: bold;
	}
	.style_206
	{
		color: #17ce090;
		background-color: #000000;
		font-weight: bold;
	}
	.style_210
	{
		color: #000000;
		background-color: #000000;
		font-weight: bold;
	}
	.style_212
	{
		color: #3a26d720;
		background-color: #007faa;
		font-weight: bold;
	}
	.style_214
	{
		color: #39f376fe;
		background-color: #007faa;
	}
	.style_218
	{
		color: #3afaeaad;
		background-color: #007faa;
		font-weight: bold;
	}
	.style_219
	{
		color: #007faa;
		background-color: #1fcc8c0;
		font-style: italic;
	}
	.style_222
	{
		color: #177f880;
		background-color: #000000;
	}
	.style_226
	{
		color: #180aae0;
		background-color: #000000;
	}
	.style_228
	{
		color: #20ba3d0;
		background-color: #000000;
		font-weight: bold;
		font-style: italic;
	}
	.style_230
	{
		color: #3a26d720;
		background-color: #007faa;
		font-weight: bold;
	}
	.style_234
	{
		color: #000035;
		background-color: #000000;
		font-weight: bold;
	}
	.style_236
	{
		color: #000000;
		background-color: #000000;
		font-weight: bold;
		font-style: italic;
	}
	.style_237
	{
		color: #000000;
		background-color: #20a7a80;
		font-style: italic;
	}
	.style_238
	{
		color: #000000;
		background-color: #007faa;
		font-weight: bold;
	}
	.style_240
	{
		color: #20a7a80;
		background-color: #000000;
		font-weight: bold;
		font-style: italic;
	}
	.style_242
	{
		color: #d3a781e8;
		background-color: #007fff;
	}
	.style_243
	{
		color: #000000;
		background-color: #000000;
		font-style: italic;
	}
	.style_244
	{
		color: #1aa43f0;
		background-color: #000000;
		font-weight: bold;
		font-style: italic;
	}
	.style_245
	{
		color: #007fff;
		background-color: #1aa43f0;
		font-style: italic;
	}
	.style_246
	{
		color: #3a26d720;
		background-color: #007faa;
		font-weight: bold;
		font-style: italic;
	}
	.style_248
	{
		color: #000000;
		background-color: #000000;
		font-weight: bold;
		font-style: italic;
	}
	.style_249
	{
		color: #000000;
		background-color: #000034;
		font-style: italic;
	}
	.style_250
	{
		color: #3acd83ac;
		background-color: #007faa;
	}
	.style_252
	{
		color: #210c780;
		background-color: #000000;
		font-weight: bold;
		font-style: italic;
	}
	.style_254
	{
		color: #3acceff4;
		background-color: #007faa;
		font-weight: bold;
	}

	</style>
</head>

<body>
<p>
<span class="style_2">--&nbsp;Raccourcis</span><br />
<span class="style_5">local&nbsp;</span><span class="style_11">physics&nbsp;</span><span class="style_10">=&nbsp;</span><span class="style_11">love.physics</span><br />
<span class="style_5">local&nbsp;</span><span class="style_11">graphics&nbsp;</span><span class="style_10">=&nbsp;</span><span class="style_11">love.graphics</span><br />
<br />
<span class="style_2">--&nbsp;Un&nbsp;niveau&nbsp;du&nbsp;jeu</span><br />
<span class="style_5">local&nbsp;</span><span class="style_11">Level&nbsp;</span><span class="style_10">=&nbsp;</span><span class="style_11">Object</span><span class="style_10">:</span><span class="style_11">subclass</span><span class="style_10">(</span><span class="style_7">'Level'</span><span class="style_10">)</span><br />
<br />
<span class="style_2">--&nbsp;Initialisation</span><br />
<span class="style_5">function&nbsp;</span><span class="style_11">Level</span><span class="style_10">:</span><span class="style_11">initialize</span><span class="style_10">(</span><span class="style_11">name</span><span class="style_10">,&nbsp;</span><span class="style_11">map</span><span class="style_10">,&nbsp;</span><span class="style_11">cameraFocus</span><span class="style_10">)</span><br />
&nbsp;&nbsp;<span class="style_11">self.name&nbsp;</span><span class="style_10">=&nbsp;</span><span class="style_11">name</span><br />
&nbsp;&nbsp;<span class="style_11">self.map&nbsp;</span><span class="style_10">=&nbsp;</span><span class="style_11">map</span><br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;<span class="style_2">--&nbsp;Création&nbsp;du&nbsp;monde</span><br />
&nbsp;&nbsp;<span class="style_11">physics.setMeter</span><span class="style_10">(</span><span class="style_4">64</span><span class="style_10">)</span><br />
&nbsp;&nbsp;<span class="style_11">self.world&nbsp;</span><span class="style_10">=&nbsp;</span><span class="style_11">physics.newWorld</span><span class="style_10">(</span><span class="style_4">0</span><span class="style_10">,&nbsp;</span><span class="style_4">9.81&nbsp;</span><span class="style_10">*&nbsp;</span><span class="style_11">physics.getMeter</span><span class="style_10">(),&nbsp;</span><span class="style_5">true</span><span class="style_10">)</span><br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;<span class="style_2">--&nbsp;Tableau&nbsp;des&nbsp;boîtes&nbsp;de&nbsp;collision&nbsp;statiques</span><br />
&nbsp;&nbsp;<span class="style_11">self.staticHitboxes&nbsp;</span><span class="style_10">=&nbsp;{}</span><br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;<span class="style_5">for&nbsp;</span><span class="style_11">x</span><span class="style_10">,&nbsp;</span><span class="style_11">y</span><span class="style_10">,&nbsp;</span><span class="style_11">tile&nbsp;</span><span class="style_5">in&nbsp;</span><span class="style_11">self.map.layers.ground</span><span class="style_10">:</span><span class="style_11">rectangle</span><span class="style_10">(</span><span class="style_4">0</span><span class="style_10">,&nbsp;</span><span class="style_4">0</span><span class="style_10">,&nbsp;</span><span class="style_11">self.map.width&nbsp;</span><span class="style_10">-&nbsp;</span><span class="style_4">1</span><span class="style_10">,&nbsp;</span><span class="style_11">self.map.height&nbsp;</span><span class="style_10">-&nbsp;</span><span class="style_4">1</span><span class="style_10">)&nbsp;</span><span class="style_5">do</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="style_5">if&nbsp;</span><span class="style_11">tile.properties.solid&nbsp;</span><span class="style_5">then</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="style_5">local&nbsp;</span><span class="style_11">hitBox&nbsp;</span><span class="style_10">=&nbsp;{}</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="style_11">hitBox.body&nbsp;</span><span class="style_10">=&nbsp;</span><span class="style_11">physics.newBody</span><span class="style_10">(</span><span class="style_11">self.world</span><span class="style_10">,&nbsp;</span><span class="style_11">x&nbsp;</span><span class="style_10">*&nbsp;</span><span class="style_11">tile.width&nbsp;</span><span class="style_10">+&nbsp;</span><span class="style_11">tile.width&nbsp;</span><span class="style_10">/&nbsp;</span><span class="style_4">2</span><span class="style_10">,&nbsp;</span><span class="style_11">y&nbsp;</span><span class="style_10">*&nbsp;</span><span class="style_11">tile.height&nbsp;</span><span class="style_10">+&nbsp;</span><span class="style_11">tile.height&nbsp;</span><span class="style_10">/&nbsp;</span><span class="style_4">2</span><span class="style_10">)</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="style_11">hitBox.shape&nbsp;</span><span class="style_10">=&nbsp;</span><span class="style_11">physics.newRectangleShape</span><span class="style_10">(</span><span class="style_11">tile.width</span><span class="style_10">,&nbsp;</span><span class="style_11">tile.height</span><span class="style_10">)</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="style_11">hitBox.fixture&nbsp;</span><span class="style_10">=&nbsp;</span><span class="style_11">physics.newFixture</span><span class="style_10">(</span><span class="style_11">hitBox.body</span><span class="style_10">,&nbsp;</span><span class="style_11">hitBox.shape</span><span class="style_10">)</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="style_14">table.insert</span><span class="style_10">(</span><span class="style_11">self.staticHitboxes</span><span class="style_10">,&nbsp;</span><span class="style_11">hitBox</span><span class="style_10">)</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="style_5">end</span><br />
&nbsp;&nbsp;<span class="style_5">end</span><br />
<span class="style_5">end</span><br />
<br />
<span class="style_2">--&nbsp;Mise&nbsp;à&nbsp;jour</span><br />
<span class="style_5">function&nbsp;</span><span class="style_11">Level</span><span class="style_10">:</span><span class="style_11">update</span><span class="style_10">(</span><span class="style_11">dt</span><span class="style_10">)</span><br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;<span class="style_5">local&nbsp;</span><span class="style_11">map&nbsp;</span><span class="style_10">=&nbsp;</span><span class="style_11">self.map</span><br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;<span class="style_2">--&nbsp;Mise&nbsp;à&nbsp;jour&nbsp;du&nbsp;moteur&nbsp;physique</span><br />
&nbsp;&nbsp;<span class="style_11">self.world</span><span class="style_10">:</span><span class="style_11">update</span><span class="style_10">(</span><span class="style_11">dt</span><span class="style_10">)</span><br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;<span class="style_2">--&nbsp;Mise&nbsp;à&nbsp;jour&nbsp;de&nbsp;la&nbsp;position&nbsp;de&nbsp;la&nbsp;caméra</span><br />
&nbsp;&nbsp;<span class="style_5">local&nbsp;</span><span class="style_11">focus&nbsp;</span><span class="style_10">=&nbsp;</span><span class="style_11">self.cameraFocus&nbsp;</span><span class="style_5">and&nbsp;</span><span class="style_11">Vector</span><span class="style_10">(</span><span class="style_11">self.cameraFocus.pos.x</span><span class="style_10">,&nbsp;</span><span class="style_11">self.cameraFocus.pos.y</span><span class="style_10">)&nbsp;</span><span class="style_5">or&nbsp;</span><span class="style_11">Vector</span><span class="style_10">(</span><span class="style_4">0</span><span class="style_10">,&nbsp;</span><span class="style_4">0</span><span class="style_10">)</span><br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;<span class="style_5">if&nbsp;</span><span class="style_11">focus.x&nbsp;</span><span class="style_10">&lt;&nbsp;</span><span class="style_11">screen.w</span><span class="style_10">()&nbsp;/&nbsp;</span><span class="style_4">2&nbsp;</span><span class="style_5">then</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="style_11">focus.x&nbsp;</span><span class="style_10">=&nbsp;</span><span class="style_11">screen.w</span><span class="style_10">()&nbsp;/&nbsp;</span><span class="style_4">2</span><br />
&nbsp;&nbsp;<span class="style_5">elseif&nbsp;</span><span class="style_11">focus.x&nbsp;</span><span class="style_10">&gt;&nbsp;</span><span class="style_11">map.width&nbsp;</span><span class="style_10">*&nbsp;</span><span class="style_11">map.tileWidth&nbsp;</span><span class="style_10">-&nbsp;</span><span class="style_11">screen.w</span><span class="style_10">()&nbsp;/&nbsp;</span><span class="style_4">2&nbsp;</span><span class="style_5">then</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="style_11">focus.x&nbsp;</span><span class="style_10">=&nbsp;</span><span class="style_11">map.width&nbsp;</span><span class="style_10">*&nbsp;</span><span class="style_11">map.tileWidth&nbsp;</span><span class="style_10">-&nbsp;</span><span class="style_11">screen.w</span><span class="style_10">()&nbsp;/&nbsp;</span><span class="style_4">2</span><br />
&nbsp;&nbsp;<span class="style_5">end</span><br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;<span class="style_5">if&nbsp;</span><span class="style_11">focus.y&nbsp;</span><span class="style_10">&lt;&nbsp;</span><span class="style_11">screen.h</span><span class="style_10">()&nbsp;/&nbsp;</span><span class="style_4">2&nbsp;</span><span class="style_5">then</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="style_11">focus.y&nbsp;</span><span class="style_10">=&nbsp;</span><span class="style_11">screen.h</span><span class="style_10">()&nbsp;/&nbsp;</span><span class="style_4">2</span><br />
&nbsp;&nbsp;<span class="style_5">elseif&nbsp;</span><span class="style_11">focus.y&nbsp;</span><span class="style_10">&gt;&nbsp;</span><span class="style_11">map.height&nbsp;</span><span class="style_10">*&nbsp;</span><span class="style_11">map.tileHeight&nbsp;</span><span class="style_10">-&nbsp;</span><span class="style_11">screen.h</span><span class="style_10">()&nbsp;/&nbsp;</span><span class="style_4">2&nbsp;</span><span class="style_5">then</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="style_11">focus.y&nbsp;</span><span class="style_10">=&nbsp;</span><span class="style_11">map.height&nbsp;</span><span class="style_10">*&nbsp;</span><span class="style_11">map.tileHeight&nbsp;</span><span class="style_10">-&nbsp;</span><span class="style_11">screen.h</span><span class="style_10">()&nbsp;/&nbsp;</span><span class="style_4">2</span><br />
&nbsp;&nbsp;<span class="style_5">end</span><br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;<span class="style_2">--&nbsp;Centrer&nbsp;la&nbsp;caméra</span><br />
&nbsp;&nbsp;<span class="style_11">game.camera</span><span class="style_10">:</span><span class="style_11">lookAt</span><span class="style_10">(</span><span class="style_11">focus.x</span><span class="style_10">,&nbsp;</span><span class="style_11">focus.y</span><span class="style_10">)</span><br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;<span class="style_2">--&nbsp;Mettre&nbsp;à&nbsp;jour&nbsp;la&nbsp;zone&nbsp;affichée&nbsp;de&nbsp;la&nbsp;map</span><br />
&nbsp;&nbsp;<span class="style_11">map</span><span class="style_10">:</span><span class="style_11">autoDrawRange</span><span class="style_10">(</span><span class="style_11">focus.x</span><span class="style_10">,&nbsp;</span><span class="style_11">focus.y</span><span class="style_10">,&nbsp;</span><span class="style_4">1</span><span class="style_10">)</span><br />
<span class="style_5">end</span><br />
<br />
<span class="style_2">--&nbsp;Affichage</span><br />
<span class="style_5">function&nbsp;</span><span class="style_11">Level</span><span class="style_10">:</span><span class="style_11">draw</span><span class="style_10">()</span><br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;<span class="style_2">--&nbsp;Fond</span><br />
&nbsp;&nbsp;<span class="style_11">graphics.setColor</span><span class="style_10">(</span><span class="style_4">155</span><span class="style_10">,&nbsp;</span><span class="style_4">194</span><span class="style_10">,&nbsp;</span><span class="style_4">140</span><span class="style_10">)</span><br />
&nbsp;&nbsp;<span class="style_11">graphics.rectangle</span><span class="style_10">(</span><span class="style_7">'fill'</span><span class="style_10">,&nbsp;</span><span class="style_4">0</span><span class="style_10">,&nbsp;</span><span class="style_4">0</span><span class="style_10">,&nbsp;</span><span class="style_11">screen.w</span><span class="style_10">(),&nbsp;</span><span class="style_11">screen.h</span><span class="style_10">())</span><br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;<span class="style_2">--&nbsp;Caméra</span><br />
&nbsp;&nbsp;<span class="style_11">game.camera</span><span class="style_10">:</span><span class="style_11">attach</span><span class="style_10">()</span><br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;<span class="style_2">--&nbsp;Affichage&nbsp;de&nbsp;la&nbsp;map</span><br />
&nbsp;&nbsp;<span class="style_11">self.map</span><span class="style_10">:</span><span class="style_11">draw</span><span class="style_10">()</span><br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;<span class="style_5">if&nbsp;</span><span class="style_11">core.debug.drawHitboxes&nbsp;</span><span class="style_5">then</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="style_2">--&nbsp;Affichage&nbsp;des&nbsp;hitboxes</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="style_5">for&nbsp;</span><span class="style_11">i</span><span class="style_10">,&nbsp;</span><span class="style_11">hitBox&nbsp;</span><span class="style_5">in&nbsp;</span><span class="style_13">ipairs</span><span class="style_10">(</span><span class="style_11">self.staticHitboxes</span><span class="style_10">)&nbsp;</span><span class="style_5">do</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="style_11">graphics.setColor</span><span class="style_10">(</span><span class="style_4">96</span><span class="style_10">,&nbsp;</span><span class="style_4">196</span><span class="style_10">,&nbsp;</span><span class="style_4">0</span><span class="style_10">,&nbsp;</span><span class="style_4">96</span><span class="style_10">)</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="style_11">graphics.polygon</span><span class="style_10">(</span><span class="style_6">"fill"</span><span class="style_10">,&nbsp;</span><span class="style_11">hitBox.body</span><span class="style_10">:</span><span class="style_11">getWorldPoints</span><span class="style_10">(</span><span class="style_11">hitBox.shape</span><span class="style_10">:</span><span class="style_11">getPoints</span><span class="style_10">()))</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="style_11">graphics.setColor</span><span class="style_10">(</span><span class="style_4">96</span><span class="style_10">,&nbsp;</span><span class="style_4">196</span><span class="style_10">,&nbsp;</span><span class="style_4">0</span><span class="style_10">,&nbsp;</span><span class="style_4">192</span><span class="style_10">)</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="style_11">graphics.polygon</span><span class="style_10">(</span><span class="style_6">"line"</span><span class="style_10">,&nbsp;</span><span class="style_11">hitBox.body</span><span class="style_10">:</span><span class="style_11">getWorldPoints</span><span class="style_10">(</span><span class="style_11">hitBox.shape</span><span class="style_10">:</span><span class="style_11">getPoints</span><span class="style_10">()))</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="style_5">end</span><br />
&nbsp;&nbsp;<span class="style_5">end</span><br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;<span class="style_2">--&nbsp;Caméra</span><br />
&nbsp;&nbsp;<span class="style_11">game.camera</span><span class="style_10">:</span><span class="style_11">detach</span><span class="style_10">()</span><br />
<span class="style_5">end</span><br />
<br />
<span class="style_2">--&nbsp;Arrêt</span><br />
<span class="style_5">function&nbsp;</span><span class="style_11">Level</span><span class="style_10">:</span><span class="style_11">stop</span><span class="style_10">()</span><br />
<span class="style_5">end</span><br />
<br />
<span class="style_2">--&nbsp;Démarrage</span><br />
<span class="style_5">function&nbsp;</span><span class="style_11">Level</span><span class="style_10">:</span><span class="style_11">levelStart</span><span class="style_10">()</span><br />
<span class="style_5">end</span><br />
<br />
<span class="style_2">--&nbsp;Lorsque&nbsp;le&nbsp;joueur&nbsp;entre&nbsp;dans&nbsp;la&nbsp;zone&nbsp;de&nbsp;fin&nbsp;de&nbsp;niveau</span><br />
<span class="style_5">function&nbsp;</span><span class="style_11">Level</span><span class="style_10">:</span><span class="style_11">levelEnd</span><span class="style_10">()</span><br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;<span class="style_2">--&nbsp;Avertir&nbsp;la&nbsp;PlayState&nbsp;de&nbsp;la&nbsp;fin&nbsp;du&nbsp;niveau</span><br />
&nbsp;&nbsp;<span class="style_11">core.states.play</span><span class="style_10">:</span><span class="style_11">levelEnd</span><span class="style_10">()</span><br />
<span class="style_5">end</span><br />
<br />
<span class="style_5">return&nbsp;</span><span class="style_11">Level</span>
</p>
</body>
</html>
